import{GridStackEngine}from"./gridstack-engine";import{Utils,obsolete}from"./utils";import{gridDefaults,dragInDefaultOptions}from"./types";import{DDGridStack}from"./dd-gridstack";import{isTouch}from"./dd-touch";import{DDManager}from"./dd-manager";const dd=new DDGridStack;export*from"./types";export*from"./utils";export*from"./gridstack-engine";export*from"./dd-gridstack";class GridStack{static init(t={},e=".grid-stack"){if("undefined"==typeof document)return null;let i=GridStack.getGridElement(e);return i?(i.gridstack||(i.gridstack=new GridStack(i,Utils.cloneDeep(t))),i.gridstack):("string"==typeof e?console.error('GridStack.initAll() no grid was found with selector "'+e+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.'):console.error("GridStack.init() no grid element was passed."),null)}static initAll(e={},t=".grid-stack"){let i=[];return"undefined"==typeof document||(GridStack.getGridElements(t).forEach(t=>{t.gridstack||(t.gridstack=new GridStack(t,Utils.cloneDeep(e))),i.push(t.gridstack)}),0===i.length&&console.error('GridStack.initAll() no grid was found with selector "'+t+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.')),i}static addGrid(e,i={}){if(!e)return null;let s=e;if(s.gridstack){const t=s.gridstack;return i&&(t.opts={...t.opts,...i}),void 0!==i.children&&t.load(i.children),t}if(!e.classList.contains("grid-stack")||GridStack.addRemoveCB)if(GridStack.addRemoveCB)s=GridStack.addRemoveCB(e,i,!0,!0);else{let t=document.implementation.createHTMLDocument("");t.body.innerHTML=`<div class="grid-stack ${i.class||""}"></div>`,s=t.body.children[0],e.appendChild(s)}let t=GridStack.init(i,s);return t}static registerEngine(t){GridStack.engineClass=t}get placeholder(){if(!this._placeholder){let t=document.createElement("div");t.className="placeholder-content",this.opts.placeholderText&&(t.innerHTML=this.opts.placeholderText),this._placeholder=document.createElement("div"),this._placeholder.classList.add(this.opts.placeholderClass,gridDefaults.itemClass,this.opts.itemClass),this.placeholder.appendChild(t)}return this._placeholder}constructor(t,e={}){this._gsEventHandler={},this._extraDragRow=0,this.dragTransform={xScale:1,yScale:1,xOffset:0,yOffset:0},e=e||{},((t.gridstack=this).el=t).classList.contains("grid-stack")||this.el.classList.add("grid-stack"),e.row&&(e.minRow=e.maxRow=e.row,delete e.row);var i=Utils.toNumber(t.getAttribute("gs-row"));"auto"===e.column&&delete e.column,void 0!==e.alwaysShowResizeHandle&&(e._alwaysShowResizeHandle=e.alwaysShowResizeHandle);let s=e.columnOpts?.breakpoints;const r=e;if(r.oneColumnModeDomSort&&(delete r.oneColumnModeDomSort,console.log("warning: Gridstack oneColumnModeDomSort no longer supported. Use GridStackOptions.columnOpts instead.")),r.oneColumnSize||!1===r.disableOneColumnMode){var o=r.oneColumnSize||768;delete r.oneColumnSize,delete r.disableOneColumnMode,e.columnOpts=e.columnOpts||{};let t=(s=e.columnOpts.breakpoints=e.columnOpts.breakpoints||[]).find(t=>1===t.c);t?t.w=o:(t={c:1,w:o},s.push(t,{c:12,w:o+1}))}const n=e.columnOpts;n&&(n.columnWidth||n.breakpoints?.length?n.columnMax=n.columnMax||12:(delete e.columnOpts,s=void 0)),1<s?.length&&s.sort((t,e)=>(e.w||0)-(t.w||0));let a={...Utils.cloneDeep(gridDefaults),column:Utils.toNumber(t.getAttribute("gs-column"))||gridDefaults.column,minRow:i||Utils.toNumber(t.getAttribute("gs-min-row"))||gridDefaults.minRow,maxRow:i||Utils.toNumber(t.getAttribute("gs-max-row"))||gridDefaults.maxRow,staticGrid:Utils.toBool(t.getAttribute("gs-static"))||gridDefaults.staticGrid,draggable:{handle:(e.handleClass?"."+e.handleClass:e.handle||"")||gridDefaults.draggable.handle},removableOptions:{accept:e.itemClass||gridDefaults.removableOptions.accept,decline:gridDefaults.removableOptions.decline}};t.getAttribute("gs-animate")&&(a.animate=Utils.toBool(t.getAttribute("gs-animate"))),this.opts=Utils.defaults(e,a),e=null,this._initMargin(),this.checkDynamicColumn(),this.el.classList.add("gs-"+this.opts.column),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===t.style.direction),this.opts.rtl&&this.el.classList.add("grid-stack-rtl");const l=this.el.parentElement?.parentElement;let d=l?.classList.contains(gridDefaults.itemClass)?l.gridstackNode:void 0,h=(d&&((d.subGrid=this).parentGridItem=d,this.el.classList.add("grid-stack-nested"),d.el.classList.add("grid-stack-sub-grid")),this._isAutoCellHeight="auto"===this.opts.cellHeight,this._isAutoCellHeight||"initial"===this.opts.cellHeight?this.cellHeight(void 0,!1):("number"==typeof this.opts.cellHeight&&this.opts.cellHeightUnit&&this.opts.cellHeightUnit!==gridDefaults.cellHeightUnit&&(this.opts.cellHeight=this.opts.cellHeight+this.opts.cellHeightUnit,delete this.opts.cellHeightUnit),this.cellHeight(this.opts.cellHeight,!1)),"mobile"===this.opts.alwaysShowResizeHandle&&(this.opts.alwaysShowResizeHandle=isTouch),this._styleSheetClass="gs-id-"+GridStackEngine._idSeq++,this.el.classList.add(this._styleSheetClass),this._setStaticClass(),this.opts.engineClass||GridStack.engineClass||GridStackEngine);this.engine=new h({column:this.getColumn(),float:this.opts.float,maxRow:this.opts.maxRow,onChange:t=>{let e=0;this.engine.nodes.forEach(t=>{e=Math.max(e,t.y+t.h)}),t.forEach(t=>{let e=t.el;e&&(t._removeDOM?(e&&e.remove(),delete t._removeDOM):this._writePosAttr(e,t))}),this._updateStyles(!1,e)}}),this._updateStyles(!1,0),this.opts.auto&&(this.batchUpdate(),this.getGridItems().forEach(t=>this._prepareElement(t)),this.batchUpdate(!1)),this.opts.children&&(o=this.opts.children,delete this.opts.children,o.length&&this.load(o)),this.setAnimation(this.opts.animate),this.opts.subGridDynamic&&!DDManager.pauseDrag&&(DDManager.pauseDrag=!0),void 0!==this.opts.draggable?.pause&&(DDManager.pauseDrag=this.opts.draggable.pause),this._setupRemoveDrop(),this._setupAcceptWidget(),this._updateResizeEvent()}addWidget(e,i){let s,r;if("string"==typeof e){let t=document.implementation.createHTMLDocument("");t.body.innerHTML=e,s=t.body.children[0]}else if(0===arguments.length||1===arguments.length&&(void 0!==(o=e).el||void 0!==o.x||void 0!==o.y||void 0!==o.w||void 0!==o.h||void 0!==o.content))if((r=i=e)?.el)s=r.el;else if(GridStack.addRemoveCB)s=GridStack.addRemoveCB(this.el,i,!0,!1);else{o=i?.content||"";let t=document.implementation.createHTMLDocument("");t.body.innerHTML=`<div class="grid-stack-item ${this.opts.itemClass||""}"><div class="grid-stack-item-content">${o}</div></div>`,s=t.body.children[0]}else s=e;var o;if(s){if((r=s.gridstackNode)&&s.parentElement===this.el&&this.engine.nodes.find(t=>t._id===r._id))return s;var t=this._readAttr(s);return i=Utils.cloneDeep(i)||{},Utils.defaults(i,t),r=this.engine.prepareNode(i),this._writeAttr(s,i),this._insertNotAppend?this.el.prepend(s):this.el.appendChild(s),this.makeWidget(s,i),s}}makeSubGrid(e,i,s,t=!0){let r=e.gridstackNode;if((r=r||this.makeWidget(e).gridstackNode).subGrid?.el)return r.subGrid;let o,n=this;for(;n&&!o;)o=n.opts?.subGridOpts,n=n.parentGridItem?.grid;i=Utils.cloneDeep({...o||{},children:void 0,...i||r.subGridOpts||{}});let a,l=("auto"===(r.subGridOpts=i).column&&(a=!0,i.column=Math.max(r.w||1,s?.w||1),delete i.columnOpts),r.el.querySelector(".grid-stack-item-content")),d,h;if(t){if(this._removeDD(r.el),h={...r,x:0,y:0},Utils.removeInternalForSave(h),delete h.subGridOpts,r.content&&(h.content=r.content,delete r.content),GridStack.addRemoveCB)d=GridStack.addRemoveCB(this.el,h,!0,!1);else{let t=document.implementation.createHTMLDocument("");t.body.innerHTML='<div class="grid-stack-item"></div>',(d=t.body.children[0]).appendChild(l),t.body.innerHTML='<div class="grid-stack-item-content"></div>',l=t.body.children[0],r.el.appendChild(l)}this._prepareDragDropByNode(r)}if(s){var e=a?i.column:r.w,g=r.h+s.h;let t=r.el.style;t.transition="none",this.update(r.el,{w:e,h:g}),setTimeout(()=>t.transition=null)}let p=r.subGrid=GridStack.addGrid(l,i);return s?._moving&&(p._isTemp=!0),a&&(p._autoColumn=!0),t&&p.addWidget(d,h),s&&(s._moving?window.setTimeout(()=>Utils.simulateMouseEvent(s._event,"mouseenter",p.el),0):p.addWidget(r.el,r)),p}removeAsSubGrid(t){let e=this.parentGridItem?.grid;e&&(e.batchUpdate(),e.removeWidget(this.parentGridItem.el,!0,!0),this.engine.nodes.forEach(t=>{t.x+=this.parentGridItem.x,t.y+=this.parentGridItem.y,e.addWidget(t.el,t)}),e.batchUpdate(!1),this.parentGridItem&&delete this.parentGridItem.subGrid,delete this.parentGridItem,t&&window.setTimeout(()=>Utils.simulateMouseEvent(t._event,"mouseenter",e.el),0))}save(i=!0,s=!1,r=GridStack.saveCB){let e=this.engine.save(i,r);if(e.forEach(t=>{var e;i&&t.el&&!t.subGrid&&!r?(e=t.el.querySelector(".grid-stack-item-content"),t.content=e?e.innerHTML:void 0,t.content||delete t.content):(i||r||delete t.content,t.subGrid?.el&&(e=t.subGrid.save(i,s,r),t.subGridOpts=s?e:{children:e},delete t.subGrid)),delete t.el}),s){let t=Utils.cloneDeep(this.opts);t.marginBottom===t.marginTop&&t.marginRight===t.marginLeft&&t.marginTop===t.marginRight&&(t.margin=t.marginTop,delete t.marginTop,delete t.marginRight,delete t.marginBottom,delete t.marginLeft),t.rtl===("rtl"===this.el.style.direction)&&(t.rtl="auto"),this._isAutoCellHeight&&(t.cellHeight="auto"),this._autoColumn&&(t.column="auto");var o=t._alwaysShowResizeHandle;return delete t._alwaysShowResizeHandle,void 0!==o?t.alwaysShowResizeHandle=o:delete t.alwaysShowResizeHandle,Utils.removeInternalAndSame(t,gridDefaults),t.children=e,t}return e}load(e,t=GridStack.addRemoveCB||!0){e=Utils.cloneDeep(e);const i=this.getColumn();var s=e.some(t=>void 0!==t.x||void 0!==t.y),s=(s&&(e=Utils.sort(e,-1,i)),this._insertNotAppend=s,e.some(t=>(t.x||0)+(t.w||1)>i)&&(this._ignoreLayoutsNodeChange=!0,this.engine.cacheLayout(e,12,!0)),GridStack.addRemoveCB);"function"==typeof t&&(GridStack.addRemoveCB=t);let r=[];this.batchUpdate();var o=!this.engine.nodes.length;if(o&&this.setAnimation(!1),t){let t=[...this.engine.nodes];t.forEach(t=>{t.id&&!Utils.find(e,t.id)&&(GridStack.addRemoveCB&&GridStack.addRemoveCB(this.el,t,!1,!1),r.push(t),this.removeWidget(t.el,!0,!1))})}let n=[];return this.engine.nodes=this.engine.nodes.filter(t=>!Utils.find(e,t.id)||(n.push(t),!1)),e.forEach(e=>{let i=Utils.find(n,e.id);if(i){if(Utils.shouldSizeToContent(i)&&(e.h=i.h),this.engine.nodeBoundFix(e),!e.autoPosition&&void 0!==e.x&&void 0!==e.y||(e.w=e.w||i.w,e.h=e.h||i.h,this.engine.findEmptyPosition(e)),this.engine.nodes.push(i),Utils.samePos(i,e)&&this.moveNode(i,{...e,forceCollide:!0}),this.update(i.el,e),e.subGridOpts?.children){let t=i.el.querySelector(".grid-stack");t&&t.gridstack&&(t.gridstack.load(e.subGridOpts.children),this._insertNotAppend=!0)}}else t&&this.addWidget(e)}),this.engine.removedNodes=r,this.batchUpdate(!1),delete this._ignoreLayoutsNodeChange,delete this._insertNotAppend,s?GridStack.addRemoveCB=s:delete GridStack.addRemoveCB,o&&this.opts.animate&&setTimeout(()=>this.setAnimation(this.opts.animate)),this}batchUpdate(t=!0){return this.engine.batchUpdate(t),t||(this._updateContainerHeight(),this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent()),this}getCellHeight(t=!1){if(this.opts.cellHeight&&"auto"!==this.opts.cellHeight&&(!t||!this.opts.cellHeightUnit||"px"===this.opts.cellHeightUnit))return this.opts.cellHeight;if("rem"===this.opts.cellHeightUnit)return this.opts.cellHeight*parseFloat(getComputedStyle(document.documentElement).fontSize);if("em"===this.opts.cellHeightUnit)return this.opts.cellHeight*parseFloat(getComputedStyle(this.el).fontSize);if("cm"===this.opts.cellHeightUnit)return this.opts.cellHeight*(96/2.54);if("mm"===this.opts.cellHeightUnit)return this.opts.cellHeight*(96/2.54)/10;let e=this.el.querySelector("."+this.opts.itemClass);if(e)return t=Utils.toNumber(e.getAttribute("gs-h"))||1,Math.round(e.offsetHeight/t);t=parseInt(this.el.getAttribute("gs-current-row"));return t?Math.round(this.el.getBoundingClientRect().height/t):this.opts.cellHeight}cellHeight(t,e=!0){e&&void 0!==t&&this._isAutoCellHeight!==("auto"===t)&&(this._isAutoCellHeight="auto"===t,this._updateResizeEvent()),void 0===(t="initial"!==t&&"auto"!==t?t:void 0)&&(i=-this.opts.marginRight-this.opts.marginLeft+this.opts.marginTop+this.opts.marginBottom,t=this.cellWidth()+i);var i=Utils.parseHeight(t);return this.opts.cellHeightUnit===i.unit&&this.opts.cellHeight===i.h||(this.opts.cellHeightUnit=i.unit,this.opts.cellHeight=i.h,this.resizeToContentCheck(),e&&this._updateStyles(!0)),this}cellWidth(){return this._widthOrContainer()/this.getColumn()}_widthOrContainer(t=!1){return(!t||!this.opts.columnOpts?.breakpointForWindow)&&(this.el.clientWidth||this.el.parentElement.clientWidth)||window.innerWidth}checkDynamicColumn(){const e=this.opts.columnOpts;if(!e||!e.columnWidth&&!e.breakpoints?.length)return!1;var i=this.getColumn();let s=i;var t,r=this._widthOrContainer(!0);if(e.columnWidth)s=Math.min(Math.round(r/e.columnWidth)||1,e.columnMax);else{s=e.columnMax;let t=0;for(;t<e.breakpoints.length&&r<=e.breakpoints[t].w;)s=e.breakpoints[t++].c||i}return s!==i&&(t=e.breakpoints?.find(t=>t.c===s),this.column(s,t?.layout||e.layout),!0)}compact(t="compact",e=!0){return this.engine.compact(t,e),this._triggerChangeEvent(),this}column(t,e="moveScale"){if(!t||t<1||this.opts.column===t)return this;var i=this.getColumn();return this.opts.column=t,this.engine&&(this.engine.column=t,this.el.classList.remove("gs-"+i),this.el.classList.add("gs-"+t),this.engine.columnChanged(i,t,e),this._isAutoCellHeight&&this.cellHeight(),this.resizeToContentCheck(!0),this._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange),this}getColumn(){return this.opts.column}getGridItems(){return Array.from(this.el.children).filter(t=>t.matches("."+this.opts.itemClass)&&!t.matches("."+this.opts.placeholderClass))}destroy(t=!0){if(this.el)return this.offAll(),this._updateResizeEvent(!0),this.setStatic(!0,!1),this.setAnimation(!1),t?this.el.parentNode.removeChild(this.el):(this.removeAll(t),this.el.classList.remove(this._styleSheetClass),this.el.removeAttribute("gs-current-row")),this._removeStylesheet(),this.parentGridItem&&delete this.parentGridItem.subGrid,delete this.parentGridItem,delete this.opts,delete this._placeholder,delete this.engine,delete this.el.gridstack,delete this.el,this}float(t){return this.opts.float!==t&&(this.opts.float=this.engine.float=t,this._triggerChangeEvent()),this}getFloat(){return this.engine.float}getCellFromPixel(t,e=!1){var i=this.el.getBoundingClientRect();let s;s=e?{top:i.top+document.documentElement.scrollTop,left:i.left}:{top:this.el.offsetTop,left:this.el.offsetLeft};var e=t.left-s.left,t=t.top-s.top,r=i.width/this.getColumn(),i=i.height/parseInt(this.el.getAttribute("gs-current-row"));return{x:Math.floor(e/r),y:Math.floor(t/i)}}getRow(){return Math.max(this.engine.getRow(),this.opts.minRow)}isAreaEmpty(t,e,i,s){return this.engine.isAreaEmpty(t,e,i,s)}makeWidget(t,e){t=GridStack.getElement(t),this._prepareElement(t,!0,e),e=t.gridstackNode;return this._updateContainerHeight(),e.subGridOpts&&this.makeSubGrid(t,e.subGridOpts,void 0,!1),1===this.opts.column&&(this._ignoreLayoutsNodeChange=!0),this._triggerAddEvent(),this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,t}on(e,i){if(-1===e.indexOf(" "))return"change"===e||"added"===e||"removed"===e||"enable"===e||"disable"===e?(this._gsEventHandler[e]="enable"===e||"disable"===e?t=>i(t):t=>i(t,t.detail),this.el.addEventListener(e,this._gsEventHandler[e])):"drag"===e||"dragstart"===e||"dragstop"===e||"resizestart"===e||"resize"===e||"resizestop"===e||"dropped"===e||"resizecontent"===e?this._gsEventHandler[e]=i:console.error("GridStack.on("+e+") event not supported"),this;{let t=e.split(" ");return t.forEach(t=>this.on(t,i)),this}}off(e){if(-1===e.indexOf(" "))return"change"!==e&&"added"!==e&&"removed"!==e&&"enable"!==e&&"disable"!==e||this._gsEventHandler[e]&&this.el.removeEventListener(e,this._gsEventHandler[e]),delete this._gsEventHandler[e],this;{let t=e.split(" ");return t.forEach(t=>this.off(t)),this}}offAll(){return Object.keys(this._gsEventHandler).forEach(t=>this.off(t)),this}removeWidget(t,i=!0,s=!0){return GridStack.getElements(t).forEach(e=>{if(!e.parentElement||e.parentElement===this.el){let t=e.gridstackNode;(t=t||this.engine.nodes.find(t=>e===t.el))&&(GridStack.addRemoveCB&&GridStack.addRemoveCB(this.el,t,!1,!1),delete e.gridstackNode,this._removeDD(e),this.engine.removeNode(t,i,s),i&&e.parentElement&&e.remove())}}),s&&(this._triggerRemoveEvent(),this._triggerChangeEvent()),this}removeAll(t=!0){return this.engine.nodes.forEach(t=>{delete t.el.gridstackNode,this._removeDD(t.el)}),this.engine.removeAll(t),this._triggerRemoveEvent(),this}setAnimation(t){return t?this.el.classList.add("grid-stack-animate"):this.el.classList.remove("grid-stack-animate"),this}hasAnimationCSS(){return this.el.classList.contains("grid-stack-animate")}setStatic(e,i=!0,s=!0){return!!this.opts.staticGrid===e||(e?this.opts.staticGrid=!0:delete this.opts.staticGrid,this._setupRemoveDrop(),this._setupAcceptWidget(),this.engine.nodes.forEach(t=>{this._prepareDragDropByNode(t),t.subGrid&&s&&t.subGrid.setStatic(e,i,s)}),i&&this._setStaticClass()),this}update(t,h){var e,i;return 2<arguments.length?(console.warn("gridstack.ts: `update(el, x, y, w, h)` is deprecated. Use `update(el, {x, w, content, ...})`. It will be removed soon"),i=1,h={x:(e=arguments)[i++],y:e[i++],w:e[i++],h:e[4]},this.update(t,h)):(GridStack.getElements(t).forEach(o=>{let n=o?.gridstackNode;if(n){let e=Utils.cloneDeep(h),t=(this.engine.nodeBoundFix(e),delete e.autoPosition,delete e.id,["x","y","w","h"]),i;if(t.some(t=>void 0!==e[t]&&e[t]!==n[t])&&(i={},t.forEach(t=>{i[t]=(void 0!==e[t]?e:n)[t],delete e[t]})),!i&&(e.minW||e.minH||e.maxW||e.maxH)&&(i={}),void 0!==e.content){const l=o.querySelector(".grid-stack-item-content");l&&l.innerHTML!==e.content&&(l.innerHTML=e.content,n.subGrid?.el&&(l.appendChild(n.subGrid.el),n.subGrid.opts.styleInHead||n.subGrid._updateStyles(!0))),delete e.content}let s=!1,r=!1;for(const d in e)"_"!==d[0]&&n[d]!==e[d]&&(n[d]=e[d],s=!0,r=r||!this.opts.staticGrid&&("noResize"===d||"noMove"===d||"locked"===d));var a;Utils.sanitizeMinMax(n),i&&(a=void 0!==i.w&&i.w!==n.w,this.moveNode(n,i),this.resizeToContentCheck(a,n)),(i||s)&&this._writeAttr(o,n),r&&this._prepareDragDropByNode(n)}}),this)}moveNode(t,e){this.engine.cleanNodes().beginUpdate(t).moveNode(t,e),this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()}resizeToContent(i){if(i&&(i.classList.remove("size-to-content-max"),i.clientHeight)){const n=i.gridstackNode;if(n){const a=n.grid;if(a&&i.parentElement===a.el){var s=a.getCellHeight(!0);if(s){var r=n.h?n.h*s:i.clientHeight;let t;if(t=(t=n.resizeToContentParent?i.querySelector(n.resizeToContentParent):t)||i.querySelector(GridStack.resizeToContentParent)){var o=i.clientHeight-t.clientHeight,o=n.h?n.h*s-o:t.clientHeight;let e;if(n.subGrid)e=n.subGrid.getRow()*n.subGrid.getCellHeight(!0);else{const l=t.firstElementChild;if(!l)return void console.error(`Error: GridStack.resizeToContent() widget id:${n.id} '${GridStack.resizeToContentParent}'.firstElementChild is null, make sure to have a div like container. Skipping sizing.`);e=l.getBoundingClientRect().height||o}if(o!==e){r+=e-o;let t=Math.ceil(r/s);o=Number.isInteger(n.sizeToContent)?n.sizeToContent:0;o&&t>o&&(t=o,i.classList.add("size-to-content-max")),n.minH&&t<n.minH?t=n.minH:n.maxH&&t>n.maxH&&(t=n.maxH),t!==n.h&&(a._ignoreLayoutsNodeChange=!0,a.moveNode(n,{h:t}),delete a._ignoreLayoutsNodeChange)}}}}}}}resizeToContentCBCheck(t){GridStack.resizeToContentCB?GridStack.resizeToContentCB(t):this.resizeToContent(t)}margin(t){if(!("string"==typeof t&&1<t.split(" ").length)){var e=Utils.parseHeight(t);if(this.opts.marginUnit===e.unit&&this.opts.margin===e.h)return}return this.opts.margin=t,this.opts.marginTop=this.opts.marginBottom=this.opts.marginLeft=this.opts.marginRight=void 0,this._initMargin(),this._updateStyles(!0),this}getMargin(){return this.opts.margin}willItFit(t){var e,i;return 1<arguments.length?(console.warn("gridstack.ts: `willItFit(x,y,w,h,autoPosition)` is deprecated. Use `willItFit({x, y,...})`. It will be removed soon"),i=0,i={x:(e=arguments)[i++],y:e[i++],w:e[i++],h:e[i++],autoPosition:e[4]},this.willItFit(i)):this.engine.willItFit(t)}_triggerChangeEvent(){if(this.engine.batchMode)return this;var t=this.engine.getDirtyNodes(!0);return t&&t.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(t),this._triggerEvent("change",t)),this.engine.saveInitial(),this}_triggerAddEvent(){return this.engine.batchMode||this.engine.addedNodes?.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(this.engine.addedNodes),this.engine.addedNodes.forEach(t=>{delete t._dirty}),this._triggerEvent("added",this.engine.addedNodes),this.engine.addedNodes=[]),this}_triggerRemoveEvent(){return this.engine.batchMode||this.engine.removedNodes?.length&&(this._triggerEvent("removed",this.engine.removedNodes),this.engine.removedNodes=[]),this}_triggerEvent(t,e){e=e?new CustomEvent(t,{bubbles:!1,detail:e}):new Event(t);return this.el.dispatchEvent(e),this}_removeStylesheet(){var t;return this._styles&&(t=this.opts.styleInHead?void 0:this.el.parentNode,Utils.removeStylesheet(this._styleSheetClass,t),delete this._styles),this}_updateStyles(t=!1,e){if(t&&this._removeStylesheet(),void 0===e&&(e=this.getRow()),this._updateContainerHeight(),0===this.opts.cellHeight)return this;let i=this.opts.cellHeight,s=this.opts.cellHeightUnit;var r=`.${this._styleSheetClass} > .`+this.opts.itemClass;if(!this._styles){t=this.opts.styleInHead?void 0:this.el.parentNode;if(this._styles=Utils.createStylesheet(this._styleSheetClass,t,{nonce:this.opts.nonce}),!this._styles)return this;this._styles._max=0,Utils.addCSSRule(this._styles,r,"height: "+i+s);var t=this.opts.marginTop+this.opts.marginUnit,o=this.opts.marginBottom+this.opts.marginUnit,n=this.opts.marginRight+this.opts.marginUnit,a=this.opts.marginLeft+this.opts.marginUnit,l=`.${this._styleSheetClass} > .grid-stack-placeholder > .placeholder-content`;Utils.addCSSRule(this._styles,r+" > .grid-stack-item-content",`top: ${t}; right: ${n}; bottom: ${o}; left: ${a};`),Utils.addCSSRule(this._styles,l,`top: ${t}; right: ${n}; bottom: ${o}; left: ${a};`),Utils.addCSSRule(this._styles,r+" > .ui-resizable-n",`top: ${t};`),Utils.addCSSRule(this._styles,r+" > .ui-resizable-s","bottom: "+o),Utils.addCSSRule(this._styles,r+" > .ui-resizable-ne","right: "+n),Utils.addCSSRule(this._styles,r+" > .ui-resizable-e","right: "+n),Utils.addCSSRule(this._styles,r+" > .ui-resizable-se",`right: ${n}; bottom: `+o),Utils.addCSSRule(this._styles,r+" > .ui-resizable-nw","left: "+a),Utils.addCSSRule(this._styles,r+" > .ui-resizable-w","left: "+a),Utils.addCSSRule(this._styles,r+" > .ui-resizable-sw",`left: ${a}; bottom: `+o)}if((e=e||this._styles._max)>this._styles._max){var d=t=>i*t+s;for(let t=this._styles._max+1;t<=e;t++)Utils.addCSSRule(this._styles,r+`[gs-y="${t}"]`,"top: "+d(t)),Utils.addCSSRule(this._styles,r+`[gs-h="${t+1}"]`,"height: "+d(t+1));this._styles._max=e}return this}_updateContainerHeight(){if(!this.engine||this.engine.batchMode)return this;const t=this.parentGridItem;let e=this.getRow()+this._extraDragRow;var i,s=this.opts.cellHeight,r=this.opts.cellHeightUnit;return s&&(t||0<(i=Utils.parseHeight(getComputedStyle(this.el).minHeight)).h&&i.unit===r&&(i=Math.floor(i.h/s),e<i&&(e=i)),this.el.setAttribute("gs-current-row",String(e)),this.el.style.removeProperty("min-height"),this.el.style.removeProperty("height"),e&&(this.el.style[t?"minHeight":"height"]=e*s+r),t&&!t.grid.engine.batchMode&&Utils.shouldSizeToContent(t)&&t.grid.resizeToContentCBCheck(t.el)),this}_prepareElement(t,e=!1,i){i=i||this._readAttr(t),(t.gridstackNode=i).el=t,i.grid=this,i=this.engine.addNode(i,e),this._writeAttr(t,i),t.classList.add(gridDefaults.itemClass,this.opts.itemClass);e=Utils.shouldSizeToContent(i);return e?t.classList.add("size-to-content"):t.classList.remove("size-to-content"),e&&this.resizeToContentCheck(!1,i),this._prepareDragDropByNode(i),this}_writePosAttr(t,e){return void 0!==e.x&&null!==e.x&&t.setAttribute("gs-x",String(e.x)),void 0!==e.y&&null!==e.y&&t.setAttribute("gs-y",String(e.y)),1<e.w?t.setAttribute("gs-w",String(e.w)):t.removeAttribute("gs-w"),1<e.h?t.setAttribute("gs-h",String(e.h)):t.removeAttribute("gs-h"),this}_writeAttr(t,e){if(!e)return this;this._writePosAttr(t,e);var i={autoPosition:"gs-auto-position",noResize:"gs-no-resize",noMove:"gs-no-move",locked:"gs-locked",id:"gs-id"};for(const s in i)e[s]?t.setAttribute(i[s],String(e[s])):t.removeAttribute(i[s]);return this}_readAttr(t,e=!0){let i={};i.x=Utils.toNumber(t.getAttribute("gs-x")),i.y=Utils.toNumber(t.getAttribute("gs-y")),i.w=Utils.toNumber(t.getAttribute("gs-w")),i.h=Utils.toNumber(t.getAttribute("gs-h")),i.autoPosition=Utils.toBool(t.getAttribute("gs-auto-position")),i.noResize=Utils.toBool(t.getAttribute("gs-no-resize")),i.noMove=Utils.toBool(t.getAttribute("gs-no-move")),i.locked=Utils.toBool(t.getAttribute("gs-locked")),i.id=t.getAttribute("gs-id"),i.maxW=Utils.toNumber(t.getAttribute("gs-max-w")),i.minW=Utils.toNumber(t.getAttribute("gs-min-w")),i.maxH=Utils.toNumber(t.getAttribute("gs-max-h")),i.minH=Utils.toNumber(t.getAttribute("gs-min-h")),e&&(1===i.w&&t.removeAttribute("gs-w"),1===i.h&&t.removeAttribute("gs-h"),i.maxW&&t.removeAttribute("gs-max-w"),i.minW&&t.removeAttribute("gs-min-w"),i.maxH&&t.removeAttribute("gs-max-h"),i.minH&&t.removeAttribute("gs-min-h"));for(const s in i){if(!i.hasOwnProperty(s))return;i[s]||0===i[s]||delete i[s]}return i}_setStaticClass(){var t=["grid-stack-static"];return this.opts.staticGrid?(this.el.classList.add(...t),this.el.setAttribute("gs-static","true")):(this.el.classList.remove(...t),this.el.removeAttribute("gs-static")),this}onResize(){if(this.el?.clientWidth&&this.prevWidth!==this.el.clientWidth){this.prevWidth=this.el.clientWidth,this.batchUpdate();let t=!1;return this._autoColumn&&this.parentGridItem?this.opts.column!==this.parentGridItem.w&&(this.column(this.parentGridItem.w,"none"),t=!0):t=this.checkDynamicColumn(),this._isAutoCellHeight&&this.cellHeight(),this.engine.nodes.forEach(t=>{t.subGrid&&t.subGrid.onResize()}),this._skipInitialResize||this.resizeToContentCheck(t),delete this._skipInitialResize,this.batchUpdate(!1),this}}resizeToContentCheck(t=!1,e=void 0){if(this.engine){if(t&&this.hasAnimationCSS())return setTimeout(()=>this.resizeToContentCheck(!1,e),310);if(e)Utils.shouldSizeToContent(e)&&this.resizeToContentCBCheck(e.el);else if(this.engine.nodes.some(t=>Utils.shouldSizeToContent(t))){const i=[...this.engine.nodes];this.batchUpdate(),i.forEach(t=>{Utils.shouldSizeToContent(t)&&this.resizeToContentCBCheck(t.el)}),this.batchUpdate(!1)}this._gsEventHandler.resizecontent&&this._gsEventHandler.resizecontent(null,e?[e]:this.engine.nodes)}}_updateResizeEvent(t=!1){var e=!this.parentGridItem&&(this._isAutoCellHeight||this.opts.sizeToContent||this.opts.columnOpts||this.engine.nodes.find(t=>t.sizeToContent));return t||!e||this.resizeObserver?!t&&e||!this.resizeObserver||(this.resizeObserver.disconnect(),delete this.resizeObserver,delete this._sizeThrottle):(this._sizeThrottle=Utils.throttle(()=>this.onResize(),this.opts.cellHeightThrottle),this.resizeObserver=new ResizeObserver(()=>this._sizeThrottle()),this.resizeObserver.observe(this.el),this._skipInitialResize=!0),this}static getElement(t=".grid-stack-item"){return Utils.getElement(t)}static getElements(t=".grid-stack-item"){return Utils.getElements(t)}static getGridElement(t){return GridStack.getElement(t)}static getGridElements(t){return Utils.getElements(t)}_initMargin(){let t,e=0,i=[];return 2===(i="string"==typeof this.opts.margin?this.opts.margin.split(" "):i).length?(this.opts.marginTop=this.opts.marginBottom=i[0],this.opts.marginLeft=this.opts.marginRight=i[1]):4===i.length?(this.opts.marginTop=i[0],this.opts.marginRight=i[1],this.opts.marginBottom=i[2],this.opts.marginLeft=i[3]):(t=Utils.parseHeight(this.opts.margin),this.opts.marginUnit=t.unit,e=this.opts.margin=t.h),void 0===this.opts.marginTop?this.opts.marginTop=e:(t=Utils.parseHeight(this.opts.marginTop),this.opts.marginTop=t.h,delete this.opts.margin),void 0===this.opts.marginBottom?this.opts.marginBottom=e:(t=Utils.parseHeight(this.opts.marginBottom),this.opts.marginBottom=t.h,delete this.opts.margin),void 0===this.opts.marginRight?this.opts.marginRight=e:(t=Utils.parseHeight(this.opts.marginRight),this.opts.marginRight=t.h,delete this.opts.margin),void 0===this.opts.marginLeft?this.opts.marginLeft=e:(t=Utils.parseHeight(this.opts.marginLeft),this.opts.marginLeft=t.h,delete this.opts.margin),this.opts.marginUnit=t.unit,this.opts.marginTop===this.opts.marginBottom&&this.opts.marginLeft===this.opts.marginRight&&this.opts.marginTop===this.opts.marginRight&&(this.opts.margin=this.opts.marginTop),this}static getDD(){return dd}static setupDragIn(t,e,i=document){void 0!==e?.pause&&(DDManager.pauseDrag=e.pause),e={...dragInDefaultOptions,...e||{}};let s="string"==typeof t?Utils.getElements(t,i):t;s.length&&s?.forEach(t=>{dd.isDraggable(t)||dd.dragIn(t,e)})}movable(t,i){return this.opts.staticGrid||GridStack.getElements(t).forEach(t=>{const e=t.gridstackNode;e&&(i?delete e.noMove:e.noMove=!0,this._prepareDragDropByNode(e))}),this}resizable(t,i){return this.opts.staticGrid||GridStack.getElements(t).forEach(t=>{let e=t.gridstackNode;e&&(i?delete e.noResize:e.noResize=!0,this._prepareDragDropByNode(e))}),this}disable(t=!0){if(!this.opts.staticGrid)return this.enableMove(!1,t),this.enableResize(!1,t),this._triggerEvent("disable"),this}enable(t=!0){if(!this.opts.staticGrid)return this.enableMove(!0,t),this.enableResize(!0,t),this._triggerEvent("enable"),this}enableMove(e,i=!0){return this.opts.staticGrid||(e?delete this.opts.disableDrag:this.opts.disableDrag=!0,this.engine.nodes.forEach(t=>{this._prepareDragDropByNode(t),t.subGrid&&i&&t.subGrid.enableMove(e,i)})),this}enableResize(e,i=!0){return this.opts.staticGrid||(e?delete this.opts.disableResize:this.opts.disableResize=!0,this.engine.nodes.forEach(t=>{this._prepareDragDropByNode(t),t.subGrid&&i&&t.subGrid.enableResize(e,i)})),this}_removeDD(t){return dd.draggable(t,"destroy").resizable(t,"destroy"),t.gridstackNode&&delete t.gridstackNode._initDD,delete t.ddElement,this}_setupAcceptWidget(){if(this.opts.staticGrid||!this.opts.acceptWidgets&&!this.opts.removable)return dd.droppable(this.el,"destroy"),this;let a,l,n=(t,e,i)=>{let s=e.gridstackNode;if(s){i=i||e,s.grid?.el||(i.style.transform=`scale(${1/this.dragTransform.xScale},${1/this.dragTransform.yScale})`,r=i.getBoundingClientRect(),i.style.left=r.x+(this.dragTransform.xScale-1)*(t.clientX-r.x)/this.dragTransform.xScale+"px",i.style.top=r.y+(this.dragTransform.yScale-1)*(t.clientY-r.y)/this.dragTransform.yScale+"px",i.style.transformOrigin="0px 0px");var r=this.el.getBoundingClientRect(),{top:o,left:n}=i.getBoundingClientRect(),r=(n-=r.left,{position:{top:(o-=r.top)*this.dragTransform.xScale,left:n*this.dragTransform.yScale}});if(s._temporaryRemoved){if(s.x=Math.max(0,Math.round(n/l)),s.y=Math.max(0,Math.round(o/a)),delete s.autoPosition,this.engine.nodeBoundFix(s),!this.engine.willItFit(s)){if(s.autoPosition=!0,!this.engine.willItFit(s))return void dd.off(e,"drag");s._willFitPos&&(Utils.copyPos(s,s._willFitPos),delete s._willFitPos)}this._onStartMoving(i,t,r,s,l,a)}else this._dragOrResize(i,t,r,s,l,a)}};return dd.droppable(this.el,{accept:t=>{var e,i=t.gridstackNode;if(i?.grid===this)return!0;if(!this.opts.acceptWidgets)return!1;let s=!0;return(s="function"==typeof this.opts.acceptWidgets?this.opts.acceptWidgets(t):(e=!0===this.opts.acceptWidgets?".grid-stack-item":this.opts.acceptWidgets,t.matches(e)))&&i&&this.opts.maxRow&&(t={w:i.w,h:i.h,minW:i.minW,minH:i.minH},s=this.engine.willItFit(t)),s}}).on(this.el,"dropover",(t,e,i)=>{let s=e.gridstackNode;if(s?.grid===this&&!s._temporaryRemoved)return!1;if(s?.grid&&s.grid!==this&&!s._temporaryRemoved){let t=s.grid;t._leave(e,i)}l=this.cellWidth(),a=this.getCellHeight(!0),(s=s||this._readAttr(e,!1)).grid||(s._isExternal=!0,e.gridstackNode=s),i=i||e;var r=s.w||Math.round(i.offsetWidth/l)||1,o=s.h||Math.round(i.offsetHeight/a)||1;return s.grid&&s.grid!==this?(e._gridstackNodeOrig||(e._gridstackNodeOrig=s),e.gridstackNode=s={...s,w:r,h:o,grid:this},delete s.x,delete s.y,this.engine.cleanupNode(s).nodeBoundFix(s),s._initDD=s._isExternal=s._temporaryRemoved=!0):(s.w=r,s.h=o,s._temporaryRemoved=!0),this._itemRemoving(s.el,!1),dd.on(e,"drag",n),n(t,e,i),!1}).on(this.el,"dropout",(t,e,i)=>{var s=e.gridstackNode;return s&&(s.grid&&s.grid!==this||(this._leave(e,i),this._isTemp&&this.removeAsSubGrid(s))),!1}).on(this.el,"drop",(t,e,i)=>{let s=e.gridstackNode;if(s?.grid===this&&!s._isExternal)return!1;var r=!!this.placeholder.parentElement,o=(this.placeholder.remove(),r&&this.opts.animate),n=(o&&this.setAnimation(!1),e._gridstackNodeOrig);if(delete e._gridstackNodeOrig,r&&n?.grid&&n.grid!==this){let t=n.grid;t.engine.removeNodeFromLayoutCache(n),t.engine.removedNodes.push(n),t._triggerRemoveEvent()._triggerChangeEvent(),t.parentGridItem&&!t.engine.nodes.length&&t.opts.subGridDynamic&&t.removeAsSubGrid()}if(!s)return!1;if(r&&(this.engine.cleanupNode(s),s.grid=this),delete s.grid._isTemp,dd.off(e,"drag"),i!==e?(i.remove(),e.gridstackNode=n,r&&(e=e.cloneNode(!0))):(e.remove(),this._removeDD(e)),!r)return!1;(e.gridstackNode=s).el=e;let a=s.subGrid?.el?.gridstack;return Utils.copyPos(s,this._readAttr(this.placeholder)),Utils.removePositioningStyles(e),this.el.appendChild(e),this._prepareElement(e,!0,s),a&&(a.parentGridItem=s,a.opts.styleInHead||a._updateStyles(!0)),this._updateContainerHeight(),this.engine.addedNodes.push(s),this._triggerAddEvent(),this._triggerChangeEvent(),this.engine.endUpdate(),this._gsEventHandler.dropped&&this._gsEventHandler.dropped({...t,type:"dropped"},n&&n.grid?n:void 0,s),o&&setTimeout(()=>this.setAnimation(this.opts.animate)),!1}),this}_itemRemoving(t,e){let i=t?t.gridstackNode:void 0;i&&i.grid&&!t.classList.contains(this.opts.removableOptions.decline)&&(e?i._isAboutToRemove=!0:delete i._isAboutToRemove,e?t.classList.add("grid-stack-item-removing"):t.classList.remove("grid-stack-item-removing"))}_setupRemoveDrop(){if(!this.opts.staticGrid&&"string"==typeof this.opts.removable){var t=document.querySelector(this.opts.removable);if(!t)return this;dd.isDroppable(t)||dd.droppable(t,this.opts.removableOptions).on(t,"dropover",(t,e)=>this._itemRemoving(e,!0)).on(t,"dropout",(t,e)=>this._itemRemoving(e,!1))}return this}_prepareDragDropByNode(r){let o=r.el;var t=r.noMove||this.opts.disableDrag,e=r.noResize||this.opts.disableResize;if(this.opts.staticGrid||t&&e)return r._initDD&&(this._removeDD(o),delete r._initDD),o.classList.add("ui-draggable-disabled","ui-resizable-disabled"),this;if(!r._initDD){let i,s;var n=(t,e)=>{this._gsEventHandler[t.type]&&this._gsEventHandler[t.type](t,t.target),i=this.cellWidth(),s=this.getCellHeight(!0),this._onStartMoving(o,t,e,r,i,s)},a=(t,e)=>{this._dragOrResize(o,t,e,r,i,s)},l=e=>{this.placeholder.remove(),delete r._moving,delete r._event,delete r._lastTried;var t=r.w!==r._orig.w,i=e.target;if(i.gridstackNode&&i.gridstackNode.grid===this){if(r.el=i,r._isAboutToRemove){let t=o.gridstackNode.grid;t._gsEventHandler[e.type]&&t._gsEventHandler[e.type](e,i),t.engine.nodes.push(r),t.removeWidget(o,!0,!0)}else Utils.removePositioningStyles(i),r._temporaryRemoved?(Utils.copyPos(r,r._orig),this._writePosAttr(i,r),this.engine.addNode(r)):this._writePosAttr(i,r),this._gsEventHandler[e.type]&&this._gsEventHandler[e.type](e,i);this._extraDragRow=0,this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate(),"resizestop"===e.type&&(Number.isInteger(r.sizeToContent)&&(r.sizeToContent=r.h),this.resizeToContentCheck(t,r))}};dd.draggable(o,{start:n,stop:l,drag:a}).resizable(o,{start:n,stop:l,resize:a}),r._initDD=!0}return dd.draggable(o,t?"disable":"enable").resizable(o,e?"disable":"enable"),this}_onStartMoving(t,e,i,s,r,o){var n;this.engine.cleanNodes().beginUpdate(s),this._writePosAttr(this.placeholder,s),this.el.appendChild(this.placeholder),s.grid?.el?this.dragTransform=Utils.getValuesFromTransformedElement(t):this.placeholder&&this.placeholder.closest(".grid-stack")?(n=this.placeholder.closest(".grid-stack"),this.dragTransform=Utils.getValuesFromTransformedElement(n)):this.dragTransform={xScale:1,xOffset:0,yScale:1,yOffset:0},s.el=this.placeholder,s._lastUiPosition=i.position,s._prevYPix=i.position.top,s._moving="dragstart"===e.type,delete s._lastTried,"dropover"===e.type&&s._temporaryRemoved&&(this.engine.addNode(s),s._moving=!0),this.engine.cacheRects(r,o,this.opts.marginTop,this.opts.marginRight,this.opts.marginBottom,this.opts.marginLeft),"resizestart"===e.type&&(dd.resizable(t,"option","minWidth",r*(s.minW||1)).resizable(t,"option","minHeight",o*(s.minH||1)),s.maxW&&dd.resizable(t,"option","maxWidth",r*s.maxW),s.maxH&&dd.resizable(t,"option","maxHeight",o*s.maxH))}_dragOrResize(t,e,i,s,r,o){let n={...s._orig},a;var l=this.opts.marginLeft,d=this.opts.marginRight,h=this.opts.marginTop,g=this.opts.marginBottom,p=Math.round(.1*o),c=Math.round(.1*r),l=Math.min(l,c),d=Math.min(d,c),h=Math.min(h,p),g=Math.min(g,p);if("drag"===e.type){if(s._temporaryRemoved)return;c=i.position.top-s._prevYPix,p=(s._prevYPix=i.position.top,!1!==this.opts.draggable.scroll&&Utils.updateScrollPosition(t,i.position,c),i.position.left+(i.position.left>s._lastUiPosition.left?-d:l)),c=i.position.top+(i.position.top>s._lastUiPosition.top?-g:h),p=(n.x=Math.round(p/r),n.y=Math.round(c/o),this._extraDragRow);if(this.engine.collide(s,n)){c=this.getRow();let t=Math.max(0,n.y+s.h-c);this.opts.maxRow&&c+t>this.opts.maxRow&&(t=Math.max(0,this.opts.maxRow-c)),this._extraDragRow=t}else this._extraDragRow=0;if(this._extraDragRow!==p&&this._updateContainerHeight(),s.x===n.x&&s.y===n.y)return}else if("resize"===e.type){if(n.x<0)return;if(Utils.updateScrollResize(e,t,o),n.w=Math.round((i.size.width-l)/r),n.h=Math.round((i.size.height-h)/o),s.w===n.w&&s.h===n.h)return;if(s._lastTried&&s._lastTried.w===n.w&&s._lastTried.h===n.h)return;c=i.position.left+l,p=i.position.top+h;n.x=Math.round(c/r),n.y=Math.round(p/o),a=!0}s._event=e,s._lastTried=n;t={x:i.position.left+l,y:i.position.top+h,w:(i.size?i.size.width:s.w*r)-l-d,h:(i.size?i.size.height:s.h*o)-h-g};this.engine.moveNodeCheck(s,{...n,cellWidth:r,cellHeight:o,rect:t,resizing:a})&&(s._lastUiPosition=i.position,this.engine.cacheRects(r,o,h,d,g,l),delete s._skipDown,a&&s.subGrid&&s.subGrid.onResize(),this._extraDragRow=0,this._updateContainerHeight(),c=e.target,this._writePosAttr(c,s),this._gsEventHandler[e.type]&&this._gsEventHandler[e.type](e,c))}_leave(t,e){let i=t.gridstackNode;i&&((e=e||t).style.transform="scale(1)",dd.off(t,"drag"),i._temporaryRemoved||(i._temporaryRemoved=!0,this.engine.removeNode(i),i.el=i._isExternal&&e?e:t,!0===this.opts.removable&&this._itemRemoving(t,!0),t._gridstackNodeOrig?(t.gridstackNode=t._gridstackNodeOrig,delete t._gridstackNodeOrig):i._isExternal&&(delete i.el,delete t.gridstackNode,this.engine.restoreInitial())))}commit(){return obsolete(this,this.batchUpdate(!1),"commit","batchUpdate","5.2"),this}}GridStack.resizeToContentParent=".grid-stack-item-content",GridStack.Utils=Utils,GridStack.Engine=GridStackEngine,GridStack.GDRev="10.1.0";export{GridStack};